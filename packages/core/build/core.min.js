/*
lowww-core - version: 1.1.5
Copyright Â© 2018 Andre Venancio (info@andrevenancio.com)
*/
var e,t;e=this,t=function(e){"use strict";var o={factory:function(){return"\n        // factory light\n        vec3 inverseLightDirection = normalize(vec3(-0.25, -0.25, 1.0));\n        vec3 directionalColor = vec3(max(dot(v_normal, inverseLightDirection), 0.0));\n        vec3 factory = mix(vec3(0.0), directionalColor, 0.989); // light intensity\n        base.rgb *= factory;\n\n        "+o.directional()},directional:function(){return"\n            // vec3 dcolor = vec3(0.01);\n            //\n            // for (int i = 0; i < MAX_DIRECTIONAL; i++) {\n            //     vec3 inverseLightDirection = normalize(directionalLights[i].dlPosition.xyz);\n            //     vec3 light = vec3(max(dot(v_normal, inverseLightDirection), 0.0));\n            //     vec3 directionalColor = directionalLights[i].dlColor.rgb * light;\n            //     dcolor += mix(dcolor, directionalColor, directionalLights[i].flIntensity);\n            // }\n            // dcolor /= float(MAX_DIRECTIONAL);\n            //\n            // base.rgb *= dcolor;\n        "}},a={linear:function(){return"\n        if (fogSettings.x > 0.0) {\n            \n    float fogStart = fogSettings.y;\n    float fogEnd = fogSettings.z;\n    float fogDensity = fogSettings.a;\n\n    float dist = 0.0;\n    float fogFactor = 0.0;\n    dist = gl_FragCoord.z / gl_FragCoord.w;\n            fogFactor = (fogEnd - dist) / (fogEnd - fogStart);\n            fogFactor = clamp(fogFactor, 0.0, 1.0);\n            base = mix(fogColor, base, fogFactor);\n        }"},exponential:function(){return"\n        if (fogSettings.x > 0.0) {\n            \n    float fogStart = fogSettings.y;\n    float fogEnd = fogSettings.z;\n    float fogDensity = fogSettings.a;\n\n    float dist = 0.0;\n    float fogFactor = 0.0;\n    dist = gl_FragCoord.z / gl_FragCoord.w;\n            fogFactor = 1.0 / exp(dist * fogDensity);\n            fogFactor = clamp(fogFactor, 0.0, 1.0);\n            base = mix(fogColor, base, fogFactor);\n        }"},exponential2:function(){return"\n        if (fogSettings.x > 0.0) {\n            \n    float fogStart = fogSettings.y;\n    float fogEnd = fogSettings.z;\n    float fogDensity = fogSettings.a;\n\n    float dist = 0.0;\n    float fogFactor = 0.0;\n    dist = gl_FragCoord.z / gl_FragCoord.w;\n            fogFactor = 1.0 / exp((dist * fogDensity) * (dist * fogDensity));\n            fogFactor = clamp(fogFactor, 0.0, 1.0);\n            base = mix(fogColor, base, fogFactor);\n        }"}},v=2500,s={POINTS:0,LINES:1,TRIANGLES:4},r={FRONT:0,BACK:1,BOTH:2},f={WEBGL:"webgl",WEBGL2:"webgl2"},t=Object.freeze({MAX_DIRECTIONAL:1,DIRECTIONAL_LIGHT:1e3,SHADER_BASIC:2e3,SHADER_DEFAULT:2001,SHADER_BILLBOARD:2002,SHADER_SHADOW:2003,SHADER_SEM:2004,SHADER_CUSTOM:v,DRAW:s,SIDE:r,CONTEXT:f}),h=null,d=null,g=document.createElement("canvas").getContext(f.WEBGL),p=document.createElement("canvas").getContext(f.WEBGL2),m={vertexArrayObject:g.getExtension("OES_vertex_array_object"),instancedArrays:g.getExtension("ANGLE_instanced_arrays"),standardDerivatives:g.getExtension("OES_standard_derivatives"),depthTextures:g.getExtension("WEBGL_depth_texture")},x=function(){return d},l=function(){return h},b=function(){return m},c={scene:function(){return x()===f.WEBGL2?"\n            uniform perScene {\n                mat4 projectionMatrix;\n                mat4 viewMatrix;\n                vec4 fogSettings;\n                vec4 fogColor;\n                float iGlobalTime;\n                vec4 globalClipSettings;\n                vec4 globalClipPlane0;\n                vec4 globalClipPlane1;\n                vec4 globalClipPlane2;\n            };":"\n        uniform mat4 projectionMatrix;\n        uniform mat4 viewMatrix;\n        uniform vec4 fogSettings;\n        uniform vec4 fogColor;\n        uniform float iGlobalTime;\n        uniform vec4 globalClipSettings;\n        uniform vec4 globalClipPlane0;\n        uniform vec4 globalClipPlane1;\n        uniform vec4 globalClipPlane2;"},model:function(){return x()===f.WEBGL2?"\n            uniform perModel {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n                vec4 localClipSettings;\n                vec4 localClipPlane0;\n                vec4 localClipPlane1;\n                vec4 localClipPlane2;\n            };":"\n            uniform mat4 modelMatrix;\n            uniform mat4 normalMatrix;\n            uniform vec4 localClipSettings;\n            uniform vec4 localClipPlane0;\n            uniform vec4 localClipPlane1;\n            uniform vec4 localClipPlane2;"},lights:function(){return x()===f.WEBGL2?"\n                #define MAX_DIRECTIONAL 1\n\n                struct Directional {\n                    vec4 dlPosition;\n                    vec4 dlColor;\n                    float flIntensity;\n                };\n\n                uniform directional {\n                    Directional directionalLights[MAX_DIRECTIONAL];\n                };":"\n            #define MAX_DIRECTIONAL 1\n\n            struct Directional {\n                vec4 dlPosition;\n                vec4 dlColor;\n                float flIntensity;\n            };\n\n            uniform Directional directionalLights[MAX_DIRECTIONAL];"}},u={vertex_pre:function(){return"\n        out vec4 local_eyespace;\n        out vec4 global_eyespace;"},vertex:function(){return"\n        local_eyespace = modelMatrix * vec4(a_position, 1.0);\n        global_eyespace = viewMatrix * modelMatrix * vec4(a_position, 1.0);"},fragment_pre:function(){return"\n        in vec4 local_eyespace;\n        in vec4 global_eyespace;"},fragment:function(){return"\n        if (localClipSettings.x > 0.0) {\n            if(dot(local_eyespace, localClipPlane0) < 0.0) discard;\n            if(dot(local_eyespace, localClipPlane1) < 0.0) discard;\n            if(dot(local_eyespace, localClipPlane2) < 0.0) discard;\n        }\n\n        if (globalClipSettings.x > 0.0) {\n            if(dot(global_eyespace, globalClipPlane0) < 0.0) discard;\n            if(dot(global_eyespace, globalClipPlane1) < 0.0) discard;\n            if(dot(global_eyespace, globalClipPlane2) < 0.0) discard;\n        }"}},y={vertex:function(){return x(),""},fragment:function(){return x()===f.WEBGL2?"":"\n        #extension GL_OES_standard_derivatives : enable"}},_={vertex_pre:function(){return"\n        uniform mat4 shadowMatrix;\n        out vec4 vShadowCoord;"},vertex:function(){return"\n        vShadowCoord = shadowMatrix * modelMatrix * vec4(a_position, 1.0);"},fragment_pre:function(){return"\n        uniform sampler2D shadowMap;\n        in vec4 vShadowCoord;\n\n        \n    float hardShadow1(sampler2D shadowMap) {\n        vec4 shadowCoord = vShadowCoord / vShadowCoord.w;\n        vec2 uv = shadowCoord.xy;\n        float shadow = texture(shadowMap, uv).r;\n\n        float visibility = 1.0;\n        float shadowAmount = 0.5;\n\n        float cosTheta = clamp(dot(v_normal, vShadowCoord.xyz), 0.0, 1.0);\n        float bias = 0.00005 * tan(acos(cosTheta)); // cosTheta is dot( n,l ), clamped between 0 and 1\n        bias = clamp(bias, 0.0, 0.001);\n\n        if (shadow < shadowCoord.z - bias){\n            visibility = shadowAmount;\n        }\n        return visibility;\n    }\n\n    float hardShadow2(sampler2D shadowMap) {\n        vec4 shadowCoord = vShadowCoord / vShadowCoord.w;\n        vec2 uv = shadowCoord.xy;\n\n        float lightDepth1 = texture(shadowMap, uv).r;\n        float lightDepth2 = clamp(shadowCoord.z, 0.0, 1.0);\n        float bias = 0.0001;\n\n        return step(lightDepth2, lightDepth1+bias);\n    }\n\n    float hardShadow3(sampler2D shadowMap) {\n        vec4 shadowCoord = vShadowCoord / vShadowCoord.w;\n        vec2 uv = shadowCoord.xy;\n\n        float visibility = 1.0;\n        float shadowAmount = 0.5;\n        float bias = 0.00005;\n\n        vec2 poissonDisk[16];\n        poissonDisk[0] = vec2(-0.94201624, -0.39906216);\n        poissonDisk[1] = vec2(0.94558609, -0.76890725);\n        poissonDisk[2] = vec2(-0.094184101, -0.92938870);\n        poissonDisk[3] = vec2(0.34495938, 0.29387760);\n        poissonDisk[4] = vec2(-0.91588581, 0.45771432);\n        poissonDisk[5] = vec2(-0.81544232, -0.87912464);\n        poissonDisk[6] = vec2(-0.38277543, 0.27676845);\n        poissonDisk[7] = vec2(0.97484398, 0.75648379);\n        poissonDisk[8] = vec2(0.44323325, -0.97511554);\n        poissonDisk[9] = vec2(0.53742981, -0.47373420);\n        poissonDisk[10] = vec2(-0.26496911, -0.41893023);\n        poissonDisk[11] = vec2(0.79197514, 0.19090188);\n        poissonDisk[12] = vec2(-0.24188840, 0.99706507);\n        poissonDisk[13] = vec2(-0.81409955, 0.91437590);\n        poissonDisk[14] = vec2(0.19984126, 0.78641367);\n        poissonDisk[15] = vec2(0.14383161, -0.14100790);\n\n        for (int i=0;i<16;i++) {\n            if ( texture(shadowMap, uv + poissonDisk[i]/700.0).r < shadowCoord.z-bias ){\n                visibility -= 0.02;\n            }\n        }\n\n        return visibility;\n    }\n\n    "},fragment:function(){return"\n        // shadows\n        float shadow = 1.0;\n\n        // OPTION 1\n        shadow = hardShadow1(shadowMap);\n\n        base *= shadow;\n        "}},n=Object.freeze({UBO:c,LIGHT:o,FOG:a,NOISE:function(){return"\n    vec3 mod289(vec3 x){return x-floor(x*(1./289.))*289.;}vec4 mod289(vec4 x){return x-floor(x*(1./289.))*289.;}vec4 permute(vec4 x){return mod289((x*34.+1.)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284-.853735*r;}vec3 fade(vec3 t){return t*t*t*(t*(t*6.-15.)+10.);}float cnoise(vec3 P){vec3 Pi0=floor(P),Pi1=Pi0+vec3(1.);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P),Pf1=Pf0-vec3(1.);vec4 ix=vec4(Pi0.r,Pi1.r,Pi0.r,Pi1.r),iy=vec4(Pi0.gg,Pi1.gg),iz0=Pi0.bbbb,iz1=Pi1.bbbb,ixy=permute(permute(ix)+iy),ixy0=permute(ixy+iz0),ixy1=permute(ixy+iz1),gx0=ixy0*(1./7.),gy0=fract(floor(gx0)*(1./7.))-.5;gx0=fract(gx0);vec4 gz0=vec4(.5)-abs(gx0)-abs(gy0),sz0=step(gz0,vec4(0.));gx0-=sz0*(step(0.,gx0)-.5);gy0-=sz0*(step(0.,gy0)-.5);vec4 gx1=ixy1*(1./7.),gy1=fract(floor(gx1)*(1./7.))-.5;gx1=fract(gx1);vec4 gz1=vec4(.5)-abs(gx1)-abs(gy1),sz1=step(gz1,vec4(0.));gx1-=sz1*(step(0.,gx1)-.5);gy1-=sz1*(step(0.,gy1)-.5);vec3 g000=vec3(gx0.r,gy0.r,gz0.r),g100=vec3(gx0.g,gy0.g,gz0.g),g010=vec3(gx0.b,gy0.b,gz0.b),g110=vec3(gx0.a,gy0.a,gz0.a),g001=vec3(gx1.r,gy1.r,gz1.r),g101=vec3(gx1.g,gy1.g,gz1.g),g011=vec3(gx1.b,gy1.b,gz1.b),g111=vec3(gx1.a,gy1.a,gz1.a);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.r;g010*=norm0.g;g100*=norm0.b;g110*=norm0.a;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.r;g011*=norm1.g;g101*=norm1.b;g111*=norm1.a;float n000=dot(g000,Pf0),n100=dot(g100,vec3(Pf1.r,Pf0.gb)),n010=dot(g010,vec3(Pf0.r,Pf1.g,Pf0.b)),n110=dot(g110,vec3(Pf1.rg,Pf0.b)),n001=dot(g001,vec3(Pf0.rg,Pf1.b)),n101=dot(g101,vec3(Pf1.r,Pf0.g,Pf1.b)),n011=dot(g011,vec3(Pf0.r,Pf1.gb)),n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.b);vec2 n_yz=mix(n_z.rg,n_z.ba,fade_xyz.g);float n_xyz=mix(n_yz.r,n_yz.g,fade_xyz.r);return 2.2*n_xyz;}float pnoise(vec3 P,vec3 rep){vec3 Pi0=mod(floor(P),rep),Pi1=mod(Pi0+vec3(1.),rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P),Pf1=Pf0-vec3(1.);vec4 ix=vec4(Pi0.r,Pi1.r,Pi0.r,Pi1.r),iy=vec4(Pi0.gg,Pi1.gg),iz0=Pi0.bbbb,iz1=Pi1.bbbb,ixy=permute(permute(ix)+iy),ixy0=permute(ixy+iz0),ixy1=permute(ixy+iz1),gx0=ixy0*(1./7.),gy0=fract(floor(gx0)*(1./7.))-.5;gx0=fract(gx0);vec4 gz0=vec4(.5)-abs(gx0)-abs(gy0),sz0=step(gz0,vec4(0.));gx0-=sz0*(step(0.,gx0)-.5);gy0-=sz0*(step(0.,gy0)-.5);vec4 gx1=ixy1*(1./7.),gy1=fract(floor(gx1)*(1./7.))-.5;gx1=fract(gx1);vec4 gz1=vec4(.5)-abs(gx1)-abs(gy1),sz1=step(gz1,vec4(0.));gx1-=sz1*(step(0.,gx1)-.5);gy1-=sz1*(step(0.,gy1)-.5);vec3 g000=vec3(gx0.r,gy0.r,gz0.r),g100=vec3(gx0.g,gy0.g,gz0.g),g010=vec3(gx0.b,gy0.b,gz0.b),g110=vec3(gx0.a,gy0.a,gz0.a),g001=vec3(gx1.r,gy1.r,gz1.r),g101=vec3(gx1.g,gy1.g,gz1.g),g011=vec3(gx1.b,gy1.b,gz1.b),g111=vec3(gx1.a,gy1.a,gz1.a);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.r;g010*=norm0.g;g100*=norm0.b;g110*=norm0.a;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.r;g011*=norm1.g;g101*=norm1.b;g111*=norm1.a;float n000=dot(g000,Pf0),n100=dot(g100,vec3(Pf1.r,Pf0.gb)),n010=dot(g010,vec3(Pf0.r,Pf1.g,Pf0.b)),n110=dot(g110,vec3(Pf1.rg,Pf0.b)),n001=dot(g001,vec3(Pf0.rg,Pf1.b)),n101=dot(g101,vec3(Pf1.r,Pf0.g,Pf1.b)),n011=dot(g011,vec3(Pf0.r,Pf1.gb)),n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.b);vec2 n_yz=mix(n_z.rg,n_z.ba,fade_xyz.g);float n_xyz=mix(n_yz.r,n_yz.g,fade_xyz.r);return 2.2*n_xyz;}\n"},CLIPPING:u,EXTENSIONS:y,SHADOW:_}),se=1e-6,E="undefined"!=typeof Float32Array?Float32Array:Array;function T(){var e=new E(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ce(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function le(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ue(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],c=t[5],l=t[6],u=t[7],f=t[8],h=t[9],d=t[10],v=t[11],g=t[12],p=t[13],m=t[14],x=t[15],b=n[0],y=n[1],_=n[2],E=n[3];return e[0]=b*i+y*s+_*f+E*g,e[1]=b*r+y*c+_*h+E*p,e[2]=b*o+y*l+_*d+E*m,e[3]=b*a+y*u+_*v+E*x,b=n[4],y=n[5],_=n[6],E=n[7],e[4]=b*i+y*s+_*f+E*g,e[5]=b*r+y*c+_*h+E*p,e[6]=b*o+y*l+_*d+E*m,e[7]=b*a+y*u+_*v+E*x,b=n[8],y=n[9],_=n[10],E=n[11],e[8]=b*i+y*s+_*f+E*g,e[9]=b*r+y*c+_*h+E*p,e[10]=b*o+y*l+_*d+E*m,e[11]=b*a+y*u+_*v+E*x,b=n[12],y=n[13],_=n[14],E=n[15],e[12]=b*i+y*s+_*f+E*g,e[13]=b*r+y*c+_*h+E*p,e[14]=b*o+y*l+_*d+E*m,e[15]=b*a+y*u+_*v+E*x,e}function w(e,t,n,i){var r=void 0,o=void 0,a=void 0,s=void 0,c=void 0,l=void 0,u=void 0,f=void 0,h=void 0,d=void 0,v=t[0],g=t[1],p=t[2],m=i[0],x=i[1],b=i[2],y=n[0],_=n[1],E=n[2];return Math.abs(v-y)<se&&Math.abs(g-_)<se&&Math.abs(p-E)<se?le(e):(u=v-y,f=g-_,h=p-E,r=x*(h*=d=1/Math.sqrt(u*u+f*f+h*h))-b*(f*=d),o=b*(u*=d)-m*h,a=m*f-x*u,(d=Math.sqrt(r*r+o*o+a*a))?(r*=d=1/d,o*=d,a*=d):a=o=r=0,s=f*a-h*o,c=h*r-u*a,l=u*o-f*r,(d=Math.sqrt(s*s+c*c+l*l))?(s*=d=1/d,c*=d,l*=d):l=c=s=0,e[0]=r,e[1]=s,e[2]=u,e[3]=0,e[4]=o,e[5]=c,e[6]=f,e[7]=0,e[8]=a,e[9]=l,e[10]=h,e[11]=0,e[12]=-(r*v+o*g+a*p),e[13]=-(s*v+c*g+l*p),e[14]=-(u*v+f*g+h*p),e[15]=1,e)}function i(){var e=new E(3);return e[0]=0,e[1]=0,e[2]=0,e}function P(e,t,n){var i=new E(3);return i[0]=e,i[1]=t,i[2]=n,i}function R(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}Math.PI;function A(){var e=new E(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function C(e,t,n,i){var r=new E(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}function D(){var e=new E(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}i(),A();var O,S;function M(e){return P(e>>16,e>>8&255,255&e)}function F(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?P(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)):null}function U(e){var t=e.toString(16);return 1===t.length?"0"+t:t}i(),P(1,0,0),P(0,1,0),D(),D(),(O=new E(9))[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=1,O[5]=0,O[6]=0,O[7]=0,O[8]=1,(S=new E(2))[0]=0,S[1]=0;var L=Object.freeze({hexIntToRgb:M,hexStringToRgb:F,componentToHex:U,rgbToHex:function(e,t,n){return"#"+U(e)+U(t)+U(n)},convert:function(e){var t,n=i();return R(n,P((t="number"==typeof e?M(e):F(e))[0]/255,t[1]/255,t[2]/255)),n}}),k=Object.freeze({randomRange:function(e,t){return Math.random()*(t-e)+e},mod:function(e,t){return(e%t+t)%t}}),z=function(e){return new RegExp("\\b"+e+"\\b","gi")},I=function(e){return new RegExp(""+e,"gi")},B=[{match:z("in"),replace:"attribute"},{match:z("out"),replace:"varying"}],N=[{match:z("in"),replace:"varying"},{match:I("out vec4 outColor;"),replace:""},{match:z("outColor"),replace:"gl_FragColor"},{match:z("textureProj"),replace:"texture2DProj"},{match:z("texture"),replace:function(e){var t=new RegExp("\\btexture\\b","gi"),n=new RegExp("\\btexture\\b","i"),i=new RegExp(/texture\(([^)]+)\)/,"i"),r=e.match(t),o="";if(null===r)return e;var a=!0,s=!1,c=void 0;try{for(var l,u=r[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){l.value;var f=e.match(i)[0];if(f){var h=f.replace("texture(","").split(",")[0],d=e.match("(.*?) "+h,"i")[1].replace(/^\s+|\s+$/gm,"");switch(d=d.split(" ")[1]){case"sampler2D":o="texture2D";break;case"samplerCube":o="textureCube"}}e=e.replace(n,o)}}catch(e){s=!0,c=e}finally{try{!a&&u.return&&u.return()}finally{if(s)throw c}}return e}}],j=[{match:I("#version 300 es"),replace:""}],G=[].concat(j,B),X=[].concat(j,N);function W(t,e){return x()===f.WEBGL2||("vertex"===e?G:X).forEach(function(e){t="function"==typeof e.replace?e.replace(t):t.replace(e.match,e.replace)}),t}var H=Object.freeze({color:L,math:k,glsl3to1:W}),q=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},V=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),Y=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},K=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},$=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},J=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;q(this,i),this.data=P(e,t,n)}return V(i,[{key:"set",value:function(e,t,n){this.x=e,this.y=t,this.z=n}},{key:"x",set:function(e){this.data[0]=e},get:function(){return this.data[0]}},{key:"y",set:function(e){this.data[1]=e},get:function(){return this.data[1]}},{key:"z",set:function(e){this.data[2]=e},get:function(){return this.data[2]}}]),i}(),Q=0,fe=0,he=i(),Z=function(){function e(){q(this,e),this.uid=Q++,this.parent=null,this.children=[],this.position=new J,this.rotation=new J,this.scale=new J(1,1,1),this._transparent=!1,this._visible=!0,this.quaternion=D(),this.target=i(),this.up=P(0,1,0),this.lookToTarget=!1,this.matrices={parent:T(),model:T(),lookAt:T()},this.dirty={sorting:!1,transparent:!1,attributes:!1,shader:!1},this.sceneGraphSorter=!1}return V(e,[{key:"updateMatrices",value:function(){var e,t,n,i,r,o,a,s,c,l,u,f,h,d,v,g,p,m,x,b,y,_,E,T,w,P,R,A,C,D,O,S,M,F,U,L,k,z,I,B,N,j,G,X,W,H,q,V,Y,K,$,J,Q,Z,ee,te,ne,ie,re,oe,ae;le(this.matrices.parent),le(this.matrices.model),le(this.matrices.lookAt),(e=this.quaternion)[0]=0,e[1]=0,e[2]=0,e[3]=1,this.parent&&(ce(this.matrices.parent,this.parent.matrices.model),ue(this.matrices.model,this.matrices.model,this.matrices.parent)),this.lookToTarget?(function(e,t,n,i){var r=t[0],o=t[1],a=t[2],s=i[0],c=i[1],l=i[2],u=r-n[0],f=o-n[1],h=a-n[2],d=u*u+f*f+h*h;0<d&&(u*=d=1/Math.sqrt(d),f*=d,h*=d);var v=c*h-l*f,g=l*u-s*h,p=s*f-c*u;0<(d=v*v+g*g+p*p)&&(v*=d=1/Math.sqrt(d),g*=d,p*=d),e[0]=v,e[1]=g,e[2]=p,e[3]=0,e[4]=f*p-h*g,e[5]=h*v-u*p,e[6]=u*g-f*v,e[7]=0,e[8]=u,e[9]=f,e[10]=h,e[11]=0,e[12]=r,e[13]=o,e[14]=a,e[15]=1}(this.matrices.lookAt,this.position.data,this.target,this.up),ue(this.matrices.model,this.matrices.model,this.matrices.lookAt)):(z=this.matrices.model,I=this.matrices.model,N=(B=this.position.data)[0],j=B[1],G=B[2],ee=Z=Q=J=$=K=Y=V=q=H=W=X=void 0,I===z?(z[12]=I[0]*N+I[4]*j+I[8]*G+I[12],z[13]=I[1]*N+I[5]*j+I[9]*G+I[13],z[14]=I[2]*N+I[6]*j+I[10]*G+I[14],z[15]=I[3]*N+I[7]*j+I[11]*G+I[15]):(X=I[0],W=I[1],H=I[2],q=I[3],V=I[4],Y=I[5],K=I[6],$=I[7],J=I[8],Q=I[9],Z=I[10],ee=I[11],z[0]=X,z[1]=W,z[2]=H,z[3]=q,z[4]=V,z[5]=Y,z[6]=K,z[7]=$,z[8]=J,z[9]=Q,z[10]=Z,z[11]=ee,z[12]=X*N+V*j+J*G+I[12],z[13]=W*N+Y*j+Q*G+I[13],z[14]=H*N+K*j+Z*G+I[14],z[15]=q*N+$*j+ee*G+I[15]),function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(n),c=Math.cos(n);e[0]=i*c+a*s,e[1]=r*c+o*s,e[2]=o*c-r*s,e[3]=a*c-i*s}(this.quaternion,this.quaternion,this.rotation.x),function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(n),c=Math.cos(n);e[0]=i*c-o*s,e[1]=r*c+a*s,e[2]=o*c+i*s,e[3]=a*c-r*s}(this.quaternion,this.quaternion,this.rotation.y),function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(n),c=Math.cos(n);e[0]=i*c+r*s,e[1]=r*c-i*s,e[2]=o*c+a*s,e[3]=a*c-o*s}(this.quaternion,this.quaternion,this.rotation.z),F=he,U=this.quaternion,L=2*Math.acos(U[3]),0!=(k=Math.sin(L/2))?(F[0]=U[0]/k,F[1]=U[1]/k,F[2]=U[2]/k):(F[0]=1,F[1]=0,F[2]=0),fe=L,t=this.matrices.model,n=this.matrices.model,i=fe,D=(r=he)[0],O=r[1],S=r[2],!((M=Math.sqrt(D*D+O*O+S*S))<se)&&(D*=M=1/M,O*=M,S*=M,o=Math.sin(i),s=1-(a=Math.cos(i)),c=n[0],l=n[1],u=n[2],f=n[3],h=n[4],d=n[5],v=n[6],g=n[7],p=n[8],m=n[9],x=n[10],b=n[11],y=D*D*s+a,_=O*D*s+S*o,E=S*D*s-O*o,T=D*O*s-S*o,w=O*O*s+a,P=S*O*s+D*o,R=D*S*s+O*o,A=O*S*s-D*o,C=S*S*s+a,t[0]=c*y+h*_+p*E,t[1]=l*y+d*_+m*E,t[2]=u*y+v*_+x*E,t[3]=f*y+g*_+b*E,t[4]=c*T+h*w+p*P,t[5]=l*T+d*w+m*P,t[6]=u*T+v*w+x*P,t[7]=f*T+g*w+b*P,t[8]=c*R+h*A+p*C,t[9]=l*R+d*A+m*C,t[10]=u*R+v*A+x*C,t[11]=f*R+g*A+b*C,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]))),te=this.matrices.model,ne=this.matrices.model,re=(ie=this.scale.data)[0],oe=ie[1],ae=ie[2],te[0]=ne[0]*re,te[1]=ne[1]*re,te[2]=ne[2]*re,te[3]=ne[3]*re,te[4]=ne[4]*oe,te[5]=ne[5]*oe,te[6]=ne[6]*oe,te[7]=ne[7]*oe,te[8]=ne[8]*ae,te[9]=ne[9]*ae,te[10]=ne[10]*ae,te[11]=ne[11]*ae,te[12]=ne[12],te[13]=ne[13],te[14]=ne[14],te[15]=ne[15]}},{key:"init",value:function(){}},{key:"add",value:function(e){(e.parent=this).children.push(e),this.dirty.sorting=!0}},{key:"remove",value:function(e){var t=this.children.indexOf(e);-1!==t&&(e.destroy(),this.children.splice(t,1),this.dirty.sorting=!0)}},{key:"traverse",value:function(e){void 0===e&&((e=this).sceneGraphSorter=!0);for(var t=0;t<e.children.length;t++)this.traverse(e.children[t]);return null!==e.parent&&e.updateMatrices(),(e.dirty.sorting||e.dirty.transparent)&&(e.dirty.transparent=!1,this.sceneGraphSorter=!0),this.sceneGraphSorter}},{key:"transparent",set:function(e){this.dirty.transparent=this.transparent!==e,this._transparent=e},get:function(){return this._transparent}},{key:"visible",set:function(e){this.dirty.sorting=this.visible!==e,this._visible=e},get:function(){return this._visible}}]),e}(),ee=function(e){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,n);var t=K(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return Object.assign(t,{left:-1,right:1,top:1,bottom:-1,near:-1e3,far:1e3},e),t.matrices.projection=T(),t}return Y(n,Z),V(n,[{key:"lookAt",value:function(e){R(this.target,e)}},{key:"updateCameraMatrix",value:function(){var e,t,n,i,r,o,a,s,c,l;e=this.matrices.projection,s=1/((t=this.left)-(n=this.right)),c=1/((i=this.bottom)-(r=this.top)),l=1/((o=this.near)-(a=this.far)),e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(r+i)*c,e[14]=(a+o)*l,e[15]=1}}]),n}(),te=function(e){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,n);var t=K(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return Object.assign(t,{near:1,far:1e3,fov:35},e),t.matrices.projection=T(),t}return Y(n,Z),V(n,[{key:"lookAt",value:function(e){R(this.target,e)}},{key:"updateCameraMatrix",value:function(e,t){var n,i,r,o,a,s,c;n=this.matrices.projection,i=this.fov*(Math.PI/180),r=e/t,o=this.near,a=this.far,s=1/Math.tan(i/2),c=1/(o-a),n[0]=s/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(a+o)*c,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*a*o*c,n[15]=0}}]),n}(),ne=Object.freeze({Orthographic:ee,Perspective:te}),ie=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,e);var n=t.color||P(1,1,1),i="#version 300 es\n            "+y.vertex()+"\n\n            in vec3 a_position;\n\n            "+c.scene()+"\n            "+c.model()+"\n\n            void main() {\n                gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(a_position, 1.0);\n            }\n        ",r="#version 300 es\n            "+y.fragment()+"\n\n            precision highp float;\n            precision highp int;\n\n            "+c.scene()+"\n\n            uniform vec3 u_color;\n\n            out vec4 outColor;\n\n            void main() {\n                vec4 base = vec4(u_color, 1.0);\n\n                "+a.linear()+"\n\n                outColor = base;\n            }\n        ";return Object.assign({type:2e3,mode:!0===t.wireframe?s.LINES:s.TRIANGLES},{vertex:i,fragment:r,uniforms:{u_color:{type:"vec3",value:n}}})},re=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,i);var t=l();Object.assign(this,{magFilter:t.NEAREST,minFilter:t.NEAREST,wrapS:t.CLAMP_TO_EDGE,wrapT:t.CLAMP_TO_EDGE,transparent:!1},e);var n=new Uint8Array([255,255,255,255]);this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.wrapT),this.transparent&&t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,null)}return V(i,[{key:"fromImage",value:function(e){var t=this,n=new Image;n.crossOrigin="",n.onload=function(){t.update(n)},n.src=e}},{key:"update",value:function(e){var t=l();t.bindTexture(t.TEXTURE_2D,this.texture),t.generateMipmap(t.TEXTURE_2D),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.bindTexture(t.TEXTURE_2D,null)}}]),i}(),oe=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,e);var n=t.color||P(1,1,1);this.map=new re({transparent:!0}),t.map&&this.map.fromImage(t.map),t.texture&&(this.map=t.texture);var i="#version 300 es\n            "+y.vertex()+"\n\n            in vec3 a_position;\n            in vec3 a_normal;\n            in vec2 a_uv;\n\n            "+c.scene()+"\n            "+c.model()+"\n            "+u.vertex_pre()+"\n            "+_.vertex_pre()+"\n\n            out vec3 fragVertexEc;\n            out vec2 v_uv;\n            out vec3 v_normal;\n\n            void main() {\n                vec4 worldPosition = modelMatrix * vec4(a_position, 1.0);\n                vec4 position = projectionMatrix * viewMatrix * worldPosition;\n                gl_Position = position;\n\n                fragVertexEc = position.xyz; // worldPosition.xyz;\n                v_uv = a_uv;\n                v_normal = (normalMatrix * vec4(a_normal, 1.0)).xyz;\n\n                "+_.vertex()+"\n                "+u.vertex()+"\n            }\n        ",r="#version 300 es\n            "+y.fragment()+"\n\n            precision highp float;\n            precision highp int;\n\n            in vec3 fragVertexEc;\n            in vec2 v_uv;\n            in vec3 v_normal;\n\n            "+u.fragment_pre()+"\n\n            "+c.scene()+"\n            "+c.model()+"\n            "+c.lights()+"\n\n            uniform sampler2D u_map;\n            uniform vec3 u_color;\n\n            "+_.fragment_pre()+"\n\n            out vec4 outColor;\n\n            void main() {\n                vec3 v_normal = normalize(cross(dFdx(fragVertexEc), dFdy(fragVertexEc)));\n\n                vec4 base = vec4(0.0, 0.0, 0.0, 1.0);\n                base += vec4(u_color, 1.0);\n                base *= texture(u_map, v_uv);\n\n                "+_.fragment()+"\n                "+o.factory()+"\n                "+a.linear()+"\n                "+u.fragment()+"\n\n                outColor = base;\n            }\n        ";return Object.assign({type:2001,mode:!0===t.wireframe?s.LINES:s.TRIANGLES},{vertex:i,fragment:r,uniforms:{u_map:{type:"sampler2D",value:this.map.texture},u_color:{type:"vec3",value:n}}})},ae=Object.freeze({Basic:ie,Default:oe,Billboard:function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,e),this.map=new re,t.map&&this.map.fromImage(t.map),t.texture&&(this.map=t.texture);var n="#version 300 es\n            "+y.vertex()+"\n\n            in vec3 a_position;\n            in vec2 a_uv;\n\n            "+c.scene()+"\n            "+c.model()+"\n\n            out vec2 v_uv;\n\n            void main() {\n                gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(a_position, 1.0);\n                v_uv = a_uv;\n            }\n        ",i="#version 300 es\n            "+y.fragment()+"\n\n            precision highp float;\n            precision highp int;\n\n            in vec2 v_uv;\n\n            "+c.scene()+"\n\n            uniform sampler2D u_map;\n\n            out vec4 outColor;\n\n            void main() {\n                // depth map\n                float z = texture(u_map, v_uv).r;\n                float n = 1.0;\n                float f = 1000.0;\n                float c = (2.0 * n) / (f + n - z * (f - n));\n\n                // draw depth\n                outColor = vec4(c);\n            }\n        ";return Object.assign({type:2002,mode:s.TRIANGLES},{vertex:n,fragment:i,uniforms:{u_map:{type:"sampler2D",value:this.map.texture}}})},Sem:function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,e),this.map=new re({transparent:!0}),t.map&&this.map.fromImage(t.map),t.texture&&(this.map=t.texture);var n="#version 300 es\n            "+y.vertex()+"\n\n            in vec3 a_position;\n            in vec3 a_normal;\n            in vec2 a_uv;\n\n            "+c.scene()+"\n            "+c.model()+"\n            "+u.vertex_pre()+"\n\n            out vec2 v_uv;\n\n            void main() {\n                vec4 position = viewMatrix * modelMatrix * vec4(a_position, 1.0);\n                gl_Position = projectionMatrix * position;\n\n                vec3 v_e = vec3(position);\n                vec3 v_n = mat3(viewMatrix * modelMatrix) * a_normal;\n                vec3 r = reflect(normalize(v_e), normalize(v_n));\n                float m = 2.0 * sqrt(pow(r.x, 2.0) + pow(r.y, 2.0) + pow(r.z + 1.0, 2.0));\n                v_uv = r.xy / m + 0.5;\n\n                "+u.vertex()+"\n            }\n        ",i="#version 300 es\n            "+y.fragment()+"\n\n            precision highp float;\n            precision highp int;\n\n            in vec2 v_uv;\n\n            "+u.fragment_pre()+"\n\n            "+c.scene()+"\n            "+c.model()+"\n            "+c.lights()+"\n\n            uniform sampler2D u_map;\n\n            out vec4 outColor;\n\n            void main() {\n                vec4 base = vec4(0.0, 0.0, 0.0, 1.0);\n\n                base += texture(u_map, v_uv);\n\n                "+a.linear()+"\n                "+u.fragment()+"\n\n                outColor = base;\n            }\n        ";return Object.assign({type:2004},{vertex:n,fragment:i,uniforms:{u_map:{type:"sampler2D",value:this.map.texture}}})}}),de={};function ve(e,t,n){var i=e.createShader(n);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){var r=e.getShaderInfoLog(i);throw e.deleteShader(i),console.error(r,t),new Error(r)}return i}var ge=function(){function i(e,t){q(this,i);var n=l();this.boundLocation=t,this.data=new Float32Array(e),this.buffer=n.createBuffer(),n.bindBuffer(n.UNIFORM_BUFFER,this.buffer),n.bufferData(n.UNIFORM_BUFFER,this.data,n.STATIC_DRAW),n.bindBuffer(n.UNIFORM_BUFFER,null)}return V(i,[{key:"bind",value:function(){var e=l();e.bindBufferBase(e.UNIFORM_BUFFER,this.boundLocation,this.buffer)}},{key:"update",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=l();this.data.set(e,t),n.bindBuffer(n.UNIFORM_BUFFER,this.buffer),n.bufferSubData(n.UNIFORM_BUFFER,0,this.data,0,null),n.bindBuffer(n.UNIFORM_BUFFER,null)}}]),i}(),pe=function(){function n(){q(this,n);var e=l(),t=b().vertexArrayObject;x()===f.WEBGL2?(this.vao=e.createVertexArray(),e.bindVertexArray(this.vao)):t&&(this.vao=b().vertexArrayObject.createVertexArrayOES(),t.bindVertexArrayOES(this.vao))}return V(n,[{key:"bind",value:function(){var e=l(),t=b().vertexArrayObject;x()===f.WEBGL2?e.bindVertexArray(this.vao):t&&t.bindVertexArrayOES(this.vao)}},{key:"unbind",value:function(){var e=l(),t=b().vertexArrayObject;x()===f.WEBGL2?e.bindVertexArray(null):t&&t.bindVertexArrayOES(null)}},{key:"destroy",value:function(){var e=l(),t=b().vertexArrayObject;x()===f.WEBGL2?e.deleteVertexArray(this.vao):t&&t.deleteVertexArrayOES(this.vao),this.vao=null}}]),n}(),me=function(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":case"mat2":return 4;case"mat3":return 9;case"mat4":return 16;default:throw new Error('"'+e+'" is an unknown type')}},xe=!1,be=function(e){function t(){q(this,t);var e=K(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.attributes={},e.uniforms={},e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=1,e.clipping={enable:!1,planes:[A(),A(),A()]},e.instanceCount=0,e.isInstance=!1,e.mode=s.TRIANGLES,e.side=r.FRONT,e.type=String(v),e.shadows=!0,e}return Y(t,Z),V(t,[{key:"setAttribute",value:function(e,t,n){var i=me(t);this.attributes[e]={value:n,size:i}}},{key:"setIndex",value:function(e){this.indices={value:e}}},{key:"setUniform",value:function(e,t,n){this.uniforms[e]={value:n,type:t}}},{key:"setShader",value:function(e,t){this.vertex=e,this.fragment=t}},{key:"setInstanceAttribute",value:function(e,t,n){var i=me(t);this.attributes[e]={value:n,size:i,instanced:!0}}},{key:"setInstanceCount",value:function(e){this.instanceCount=e,0<this.instanceCount?this.isInstance=!0:this.isInstance=!1}},{key:"init",value:function(){var i,r,o,a,s,e=l();xe=x()===f.WEBGL2,this.vertex&&this.fragment&&(xe||(this.vertex=W(this.vertex,"vertex"),this.fragment=W(this.fragment,"fragment")),this.program=function(e,t,n,i){var r=de["pool_"+i];if(!r){var o=ve(e,t,e.VERTEX_SHADER),a=ve(e,n,e.FRAGMENT_SHADER),s=e.createProgram();return e.attachShader(s,o),e.attachShader(s,a),e.linkProgram(s),de["pool_"+i]=s}return r}(e,this.vertex,this.fragment,this.type),e.useProgram(this.program),this.vao=new pe,function(e,t){var n=l();for(var i in e){var r=e[i],o=n.getAttribLocation(t,i),a=r.buffer;r.buffer||(a=n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,a),n.bufferData(n.ARRAY_BUFFER,r.value,n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),Object.assign(r,{location:o,buffer:a})}}(this.attributes,this.program),i=this.uniforms,r=this.program,o=l(),a=[o.TEXTURE0,o.TEXTURE1,o.TEXTURE2,o.TEXTURE3,o.TEXTURE4,o.TEXTURE5],s=0,Object.keys(i).forEach(function(e){var t=i[e],n=o.getUniformLocation(r,e);Object.assign(t,{location:n}),"sampler2D"===t.type&&(t.textureIndex=s,t.activeTexture=a[s],s++)}),this.indices&&!this.indices.buffer&&(this.indices.buffer=e.createBuffer()))}},{key:"destroy",value:function(){this.program=null}},{key:"bind",value:function(){var s,c,e=l();s=this.attributes,this.program,c=l(),Object.keys(s).forEach(function(e){var t=s[e],n=t.location,i=t.buffer,r=t.size,o=t.instanced;if(-1!==n){c.bindBuffer(c.ARRAY_BUFFER,i),c.vertexAttribPointer(n,r,c.FLOAT,!1,0,0),c.enableVertexAttribArray(n);var a=o?1:0;x()===f.WEBGL2?c.vertexAttribDivisor(n,a):b().instancedArrays.vertexAttribDivisorANGLE(n,a),c.bindBuffer(c.ARRAY_BUFFER,null)}}),this.indices&&(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indices.buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices.value,e.STATIC_DRAW))}},{key:"unbind",value:function(){var e=l();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}},{key:"update",value:function(e){var o,a,n,i,t=l();this.dirty.attributes&&(o=this.attributes,a=l(),Object.keys(o).forEach(function(e){var t=o[e],n=t.location,i=t.buffer,r=t.value;-1!==n&&(a.enableVertexAttribArray(n),a.bindBuffer(a.ARRAY_BUFFER,i),a.bufferData(a.ARRAY_BUFFER,r,a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,null))}),this.dirty.attributes=!0),n=this.uniforms,i=l(),Object.keys(n).forEach(function(e){var t=n[e];switch(t.type){case"mat4":i.uniformMatrix4fv(t.location,!1,t.value);break;case"mat3":i.uniformMatrix3fv(t.location,!1,t.value);break;case"vec4":i.uniform4fv(t.location,t.value);break;case"vec3":i.uniform3fv(t.location,t.value);break;case"vec2":i.uniform2fv(t.location,t.value);break;case"float":i.uniform1f(t.location,t.value);break;case"sampler2D":i.activeTexture(t.activeTexture),i.bindTexture(i.TEXTURE_2D,t.value),i.uniform1i(t.location,t.textureIndex);break;default:throw new Error('"'+t.type+'" is an unknown uniform type')}}),this.polygonOffset?(t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(this.polygonOffsetFactor,this.polygonOffsetUnits)):t.disable(t.POLYGON_OFFSET_FILL),this.transparent&&(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.disable(t.DEPTH_TEST)),this.side===r.FRONT?(t.enable(t.CULL_FACE),t.cullFace(t.BACK)):this.side===r.BACK?(t.enable(t.CULL_FACE),t.cullFace(t.FRONT)):this.side===r.BOTH&&t.disable(t.CULL_FACE),e&&(t.enable(t.CULL_FACE),t.cullFace(t.FRONT))}},{key:"draw",value:function(){var e=l();this.isInstance?xe?e.drawElementsInstanced(this.mode,this.indices.value.length,e.UNSIGNED_SHORT,0,this.instanceCount):b().instancedArrays.drawElementsInstancedANGLE(this.mode,this.indices.value.length,e.UNSIGNED_SHORT,0,this.instanceCount):this.indices?e.drawElements(this.mode,this.indices.value.length,e.UNSIGNED_SHORT,0):e.drawArrays(this.mode,0,this.attributes.a_position.value.length/3)}}]),t}(),ye=0,_e=function(e){function d(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,d);var t=K(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));t._shader=null;var n=e.geometry,i=n.positions,r=n.indices,o=n.normals,a=n.uvs,s=e.shader||new oe({color:e.color,map:e.map}),c=s.vertex,l=s.fragment,u=s.uniforms,f=s.type,h=s.mode;return t.type=void 0!==f?f:v+"-"+ye++,void 0!==h&&(t.mode=h),t.setAttribute("a_position","vec3",new Float32Array(i)),r&&t.setIndex(new Uint16Array(r)),o&&t.setAttribute("a_normal","vec3",new Float32Array(o)),a&&t.setAttribute("a_uv","vec2",new Float32Array(a)),Object.keys(u).forEach(function(e){t.setUniform(e,u[e].type,u[e].value)}),t.setShader(c,l),t}return Y(d,be),V(d,[{key:"shader",set:function(e){this.dirty.shader=!0,void 0!==(this._shader=e).type?this.type=e.type:this.type=v,this.setShader(e.vertex,e.fragment)},get:function(){return this._shader}}]),d}(),Ee=function(e){function h(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,h);var t=K(this,(h.__proto__||Object.getPrototypeOf(h)).call(this)),n=e&&e.size||10,i={positions:[].concat($(P(0,0,0)),$(P(n,0,0)))},r={positions:[].concat($(P(0,0,0)),$(P(0,n,0)))},o={positions:[].concat($(P(0,0,0)),$(P(0,0,n)))},a=new ie({color:P(1,0,0),wireframe:!0}),s=new ie({color:P(0,1,0),wireframe:!0}),c=new ie({color:P(0,0,1),wireframe:!0}),l=new _e({geometry:i,shader:a});t.add(l);var u=new _e({geometry:r,shader:s});t.add(u);var f=new _e({geometry:o,shader:c});return t.add(f),t}return Y(h,be),h}(),Te=function(e){function x(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,x);for(var t=K(this,(x.__proto__||Object.getPrototypeOf(x)).call(this)),n=e&&e.size||1,i={positions:[]},r=e.model.scale.x,o=e.model.scale.y,a=e.model.scale.z,s=e.model.attributes.a_normal.value.length/3,c=0;c<s;c++){var l=3*c,u=r*e.model.attributes.a_position.value[l+0],f=o*e.model.attributes.a_position.value[l+1],h=a*e.model.attributes.a_position.value[l+2],d=u+n*e.model.attributes.a_normal.value[l+0],v=f+n*e.model.attributes.a_normal.value[l+1],g=h+n*e.model.attributes.a_normal.value[l+2];i.positions=i.positions.concat([u,f,h,d,v,g])}var p=new ie({color:P(0,1,1),wireframe:!0}),m=new _e({geometry:i,shader:p});return t.add(m),t.reference=e.model,t}return Y(x,be),V(x,[{key:"update",value:function(){(function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0})(x.prototype.__proto__||Object.getPrototypeOf(x.prototype),"update",this).call(this),R(this.position.data,this.reference.position.data),R(this.rotation.data,this.reference.rotation.data),this.lookToTarget=this.reference.lookToTarget}}]),x}(),we=Object.freeze({Axis:Ee,Normals:Te}),Pe=function(){function e(){q(this,e),this.position=i()}return V(e,[{key:"destroy",value:function(){}}]),e}(),Re=function(e){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,n);var t=K(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.type=1e3,t.color=e.color||P(1,1,1),t.intensity=e.intensity||.989,t}return Y(n,Pe),n}(),Ae=function(e){function n(){q(this,n);var e=K(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));e.lights={directional:[]},e.fog={enable:!1,color:C(0,0,0,1),start:500,end:1e3,density:25e-5},e.clipping={enable:!1,planes:[A(),A(),A()]};var t=new Re({near:1,far:1e3});return t.position[0]=125,t.position[1]=250,t.position[2]=500,e.addLight(t),e}return Y(n,Z),V(n,[{key:"addLight",value:function(e){switch(e.type){case 1e3:this.lights.directional.push(e)}}},{key:"removeLight",value:function(e){var t=this.lights.directional.indexOf(e);-1!==t&&(e.destroy(),this.lights.directional.splice(t,1))}}]),n}(),Ce=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,n);var t=l();Object.assign(this,{width:512,height:512,internalformat:t.DEPTH_COMPONENT,type:t.UNSIGNED_SHORT},e),x()===f.WEBGL2&&(this.internalformat=t.DEPTH_COMPONENT24,this.type=t.UNSIGNED_INT),this.frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),this.depthTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.depthTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,this.internalformat,this.width,this.height,0,t.DEPTH_COMPONENT,this.type,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.depthTexture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}return V(n,[{key:"setSize",value:function(e,t){var n=l();this.width=e,this.height=t,n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindTexture(n.TEXTURE_2D,null),n.bindTexture(n.TEXTURE_2D,this.depthTexture),n.texImage2D(n.TEXTURE_2D,0,this.internalformat,this.width,this.height,0,n.DEPTH_COMPONENT,this.type,null),n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null)}}]),n}(),De=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,r),this.width=e.width||1024,this.height=e.height||1024;var t,n=this.width,i=this.height;this.rt=new Ce({width:n,height:i}),this.matrices={view:T(),shadow:T(),bias:(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1,t=new E(16),t[0]=.5,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=.5,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=.5,t[11]=0,t[12]=.5,t[13]=.5,t[14]=.5,t[15]=1,t)},this.camera=new te({fov:60,near:1,far:1e3}),this.camera=new ee,this.camera.position.z=1,this.setLightOrigin(e.light||P(100,250,500))}return V(r,[{key:"setLightOrigin",value:function(e){R(this.camera.position.data,e),le(this.matrices.view),w(this.matrices.view,this.camera.position.data,this.camera.target,this.camera.up),le(this.matrices.shadow),ue(this.matrices.shadow,this.camera.matrices.projection,this.matrices.view),ue(this.matrices.shadow,this.matrices.bias,this.matrices.shadow)}}]),r}(),Oe=void 0,Se=Date.now(),Me=!1,Fe=A(),Ue=A(),Le={view:T(),normal:T(),modelView:T(),inversedModelView:T()},ke=null,ze=null,Ie=function(){function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,u),this.supported=!1,this.sorted={opaque:[],transparent:[],shadow:[]},this.performance={opaque:0,transparent:0,shadow:0,vertices:0,instances:0},this.ratio=e.ratio||window.devicePixelRatio,this.shadows=e.shadows||!1,this.domElement=e.canvas||document.createElement("canvas");var t,n,i=(t=e.contextType,(d=t||p&&f.WEBGL2||g&&f.WEBGL)===f.WEBGL2&&(m.vertexArrayObject=!0,m.instancedArrays=!0,m.standardDerivatives=!0,m.depthTexture=!0),d),r=this.domElement.getContext(i,Object.assign({},{antialias:!1},e)),o=b();if(r&&(o.vertexArrayObject&&o.instancedArrays&&o.standardDerivatives&&o.depthTextures||null!==window.gli)){if(!1!==e.greeting){var a,s="color:#777;font-size:x-small",c="color:#f33;font-size:x-small",l=["%clowww-core - %cversion: %c1.1.5 %crunning: %c"+r.getParameter(r.VERSION),"color:#666;font-size:x-small;font-weight:bold;",s,c,s,c];(a=console).log.apply(a,l)}h=r,x()===f.WEBGL&&(m.vertexArrayObject=h.getExtension("OES_vertex_array_object"),m.instancedArrays=h.getExtension("ANGLE_instanced_arrays"),m.standardDerivatives=h.getExtension("OES_standard_derivatives"),m.depthTextures=h.getExtension("WEBGL_depth_texture")),Me=x()===f.WEBGL2,this.init()}else this.domElement=((n=document.createElement("div")).innerHTML='Your browser doesn\'t support WebGL.<br><a href="https://get.webgl.org">Get WebGL</a>',n.style.display="table",n.style.margin="20px auto 0 auto",n.style.border="1px solid #333",n.style.backgroundColor="rgba(255, 255, 255, 0.1)",n.style.borderRadius="4px",n.style.padding="10px",n.style.fontFamily="monospace",n.style.fontSize="12px",n.style.textAlign="center",n)}return V(u,[{key:"init",value:function(){this.supported=!0,Me&&(this.perScene=new ge([].concat($(T()),$(T()),$(Ue),$(A()),$(Fe),$(A()),$(A()),$(A()),$(A())),0),this.perModel=new ge([].concat($(T()),$(T()),$(A()),$(A()),$(A()),$(A())),1),this.directional=new ge(new Float32Array(12),2)),this.shadowmap=new De}},{key:"setSize",value:function(e,t){var n,i,r,o;this.supported&&(n=this.domElement,i=e,r=t,o=this.ratio,n.width=i*o,n.height=r*o,n.style.width=i+"px",n.style.height=r+"px")}},{key:"setRatio",value:function(e){this.ratio=e}},{key:"changeProgram",value:function(e){var t=l();if(t.useProgram(e),Me){var n=t.getUniformBlockIndex(e,"perScene"),i=t.getUniformBlockIndex(e,"perModel"),r=t.getUniformBlockIndex(e,"directional");t.uniformBlockBinding(e,n,this.perScene.boundLocation),t.uniformBlockBinding(e,i,this.perModel.boundLocation),r===this.directional.boundLocation&&t.uniformBlockBinding(e,r,this.directional.boundLocation)}}},{key:"draw",value:function(e,t,n,i){if(this.supported){ke=e,ze=t;var r=l();if(r.enable(r.DEPTH_TEST),r.enable(r.CULL_FACE),r.disable(r.BLEND),t.updateCameraMatrix(n,i),le(Le.view),w(Le.view,t.position.data,t.target,t.up),e.traverse()&&(this.sorted.opaque=[],this.sorted.transparent=[],this.sorted.shadow=[],this.performance.opaque=0,this.performance.transparent=0,this.performance.shadow=0,this.performance.vertices=0,this.performance.instances=0,this.sort(e)),Fe[0]=(Date.now()-Se)/1e3,Ue[0]=e.fog.enable,Ue[1]=e.fog.start,Ue[2]=e.fog.end,Ue[3]=e.fog.density,Me){this.perScene.bind(),this.perModel.bind(),this.directional.bind(),this.perScene.update([].concat($(t.matrices.projection),$(Le.view),$(Ue),$(e.fog.color),$(Fe),[e.clipping.enable,0,0,0],$(e.clipping.planes[0]),$(e.clipping.planes[1]),$(e.clipping.planes[2])));for(var o=0;o<e.lights.directional.length;o++)this.directional.update([].concat($(e.lights.directional[o].position),[0]).concat([].concat($(e.lights.directional[o].color),[0]),[e.lights.directional[o].intensity,0,0,0]),12*o)}if(this.shadowmap.setLightOrigin(e.lights.directional[0].position),this.renderShadow)for(var a=0;a<this.sorted.shadow.length;a++)this.renderObject(this.sorted.shadow[a],this.sorted.shadow[a].program,!0);for(var s=0;s<this.sorted.opaque.length;s++)this.renderObject(this.sorted.opaque[s],this.sorted.opaque[s].program);this.sorted.transparent.sort(function(e,t){return e.position.z-t.position.z});for(var c=0;c<this.sorted.transparent.length;c++)this.renderObject(this.sorted.transparent[c],this.sorted.transparent[c].program)}}},{key:"rtt",value:function(e){var t=e.renderTarget,n=e.scene,i=e.camera,r=e.clearColor,o=void 0===r?[0,0,0,1]:r;if(this.supported){var a=l();a.bindFramebuffer(a.FRAMEBUFFER,t.frameBuffer),a.viewport(0,0,t.width,t.height),a.clearColor.apply(a,$(o)),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.draw(n,i,t.width,t.height),a.bindTexture(a.TEXTURE_2D,t.texture),a.bindTexture(a.TEXTURE_2D,null),a.bindFramebuffer(a.FRAMEBUFFER,null)}}},{key:"render",value:function(e,t){if(this.supported){var n=l();this.shadows&&(this.renderShadow=!0,this.rtt({renderTarget:this.shadowmap.rt,scene:e,camera:this.shadowmap.camera,clearColor:[1,1,1,1]}),this.renderShadow=!1),n.viewport(0,0,n.canvas.width,n.canvas.height),n.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),this.draw(e,t,n.canvas.width,n.canvas.height)}}},{key:"updateMatrices",value:function(e){var t,n,i,r,o,a,s,c,l,u,f,h,d,v,g,p,m,x,b,y,_,E,T,w,P,R,A,C,D,O,S;le(Le.modelView),ce(Le.modelView,e),t=Le.inversedModelView,i=(n=Le.modelView)[0],r=n[1],o=n[2],a=n[3],s=n[4],c=n[5],l=n[6],u=n[7],f=n[8],h=n[9],d=n[10],v=n[11],g=n[12],p=n[13],m=n[14],(S=(b=i*c-r*s)*(O=d*(x=n[15])-v*m)-(y=i*l-o*s)*(D=h*x-v*p)+(_=i*u-a*s)*(C=h*m-d*p)+(E=r*l-o*c)*(A=f*x-v*g)-(T=r*u-a*c)*(R=f*m-d*g)+(w=o*u-a*l)*(P=f*p-h*g))&&(S=1/S,t[0]=(c*O-l*D+u*C)*S,t[1]=(o*D-r*O-a*C)*S,t[2]=(p*w-m*T+x*E)*S,t[3]=(d*T-h*w-v*E)*S,t[4]=(l*A-s*O-u*R)*S,t[5]=(i*O-o*A+a*R)*S,t[6]=(m*_-g*w-x*y)*S,t[7]=(f*w-d*_+v*y)*S,t[8]=(s*D-c*A+u*P)*S,t[9]=(r*A-i*D-a*P)*S,t[10]=(g*T-p*_+x*b)*S,t[11]=(h*_-f*T-v*b)*S,t[12]=(c*R-s*C-l*P)*S,t[13]=(i*C-r*R+o*P)*S,t[14]=(p*y-g*E-m*b)*S,t[15]=(f*E-h*y+d*b)*S),function(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=r,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(Le.inversedModelView,Le.inversedModelView),le(Le.normal),ce(Le.normal,Le.inversedModelView)}},{key:"sort",value:function(e){for(var t=0;t<e.children.length;t++)this.sort(e.children[t]);!e.visible||e instanceof Ae||(e.transparent?(this.sorted.transparent.push(e),this.performance.transparent++):(this.sorted.opaque.push(e),this.performance.opaque++),this.shadows&&e.shadows&&(this.sorted.shadow.push(e),this.performance.shadow++),e.attributes.a_position&&(this.performance.vertices+=e.attributes.a_position.value.length/3),e.isInstance&&(this.performance.instances+=e.instanceCount)),e.dirty.sorting=!1}},{key:"renderObject",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(null!==e.parent){if(this.updateMatrices(e.matrices.model),e.dirty.shader&&(e.dirty.shader=!1,t&&e.destroy()),!t)return this.initUniformsPerModel(e),void e.init();Oe!==t&&(Oe=t,this.changeProgram(Oe,e.type)),e.bind(),this.updateUniformsPerModel(e),e.update(n),e.draw(),e.unbind()}}},{key:"initUniformsPerModel",value:function(e){Me||(e.setUniform("projectionMatrix","mat4",T()),e.setUniform("viewMatrix","mat4",T()),e.setUniform("fogSettings","vec4",Ue),e.setUniform("fogColor","vec4",A()),e.setUniform("iGlobalTime","float",Fe[0]),e.setUniform("globalClipSettings","vec4",A()),e.setUniform("globalClipPlane0","vec4",A()),e.setUniform("globalClipPlane1","vec4",A()),e.setUniform("globalClipPlane2","vec4",A()),e.setUniform("modelMatrix","mat4",T()),e.setUniform("normalMatrix","mat4",T()),e.setUniform("localClipSettings","vec4",A()),e.setUniform("localClipPlane0","vec4",A()),e.setUniform("localClipPlane1","vec4",A()),e.setUniform("localClipPlane2","vec4",A()),e.setUniform("dlPosition","vec4",A()),e.setUniform("dlColor","vec4",A()),e.setUniform("flIntensity","float",0)),e.setUniform("shadowMap","sampler2D",0),e.setUniform("shadowMatrix","mat4",T()),e.setUniform("shadowNear","float",0),e.setUniform("shadowFar","float",0)}},{key:"updateUniformsPerModel",value:function(e){Me?this.perModel.update([].concat($(e.matrices.model),$(Le.normal),[e.clipping.enable,0,0,0],$(e.clipping.planes[0]),$(e.clipping.planes[1]),$(e.clipping.planes[2]))):(e.uniforms.projectionMatrix.value=ze.matrices.projection,e.uniforms.viewMatrix.value=Le.view,e.uniforms.fogSettings.value=Ue,e.uniforms.fogColor.value=ke.fog.color,e.uniforms.iGlobalTime.value=Fe[0],e.uniforms.globalClipSettings.value=[ke.clipping.enable,0,0,0],e.uniforms.globalClipPlane0.value=ke.clipping.planes[0],e.uniforms.globalClipPlane1.value=ke.clipping.planes[1],e.uniforms.globalClipPlane2.value=ke.clipping.planes[2],e.uniforms.modelMatrix.value=e.matrices.model,e.uniforms.normalMatrix.value=Le.normal,e.uniforms.localClipSettings.value=[e.clipping.enable,0,0,0],e.uniforms.localClipPlane0.value=e.clipping.planes[0],e.uniforms.localClipPlane1.value=e.clipping.planes[0],e.uniforms.localClipPlane2.value=e.clipping.planes[0]),e.uniforms.shadowMap.value=this.shadowmap.rt.depthTexture,e.uniforms.shadowMatrix.value=this.shadowmap.matrices.shadow,e.uniforms.shadowNear.value=this.shadowmap.camera.near,e.uniforms.shadowFar.value=this.shadowmap.camera.far}}]),u}(),Be=function(){function r(e){q(this,r),this.scene=new Ae;var t=e.vertex,n=e.fragment,i=e.uniforms;this.vertex=t,this.fragment=n,this.uniforms=i,this.enable=!0}return V(r,[{key:"compile",value:function(){var e={vertex:"#version 300 es\n                in vec3 a_position;\n                in vec3 a_normal;\n                in vec2 a_uv;\n\n                "+c.scene()+"\n                "+c.model()+"\n\n                "+this.vertex,fragment:"#version 300 es\n                precision highp float;\n                precision highp int;\n\n                "+c.scene()+"\n                "+c.model()+"\n\n                out vec4 outColor;\n                "+this.fragment,uniforms:this.uniforms};this.quad=new _e({geometry:{positions:[-1,-1,0,1,-1,0,1,1,0,-1,1,0],indices:[0,1,2,0,2,3],uvs:[0,0,1,0,1,1,0,1]},shader:e}),this.scene.add(this.quad)}},{key:"setUniform",value:function(e,t){this.quad.uniforms[e].value=t}}]),r}(),Ne={uniforms:{u_input:{type:"sampler2D",value:null}},vertex:"\n    out vec2 v_uv;\n    void main() {\n        gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(a_position, 1.0);\n        v_uv = a_uv;\n    }",fragment:"\n    in vec2 v_uv;\n\n    uniform sampler2D u_input;\n\n    void main() {\n        outColor = texture(u_input, v_uv);\n    }"},je=function(){function t(e){q(this,t),this.renderer=new Ie(e),this.domElement=this.renderer.domElement,this.camera=new ee,this.camera.position.z=100,this.passes=[],this.clearColor=C(0,0,0,1),this.screen=new Be(Ne),this.screen.compile(),this.buffers=[new Ce,new Ce],this.read=this.buffers[1],this.write=this.buffers[0]}return V(t,[{key:"setSize",value:function(e,t){this.renderer.setSize(e,t),this.read.setSize(e,t),this.write.setSize(e,t)}},{key:"setRatio",value:function(e){this.renderer.setRatio(e)}},{key:"pass",value:function(e){this.passes.push(e)}},{key:"compile",value:function(){for(var e=0;e<this.passes.length;e++)this.passes[e].compile()}},{key:"renderToTexture",value:function(e,t,n){this.renderer.rtt({renderTarget:e,scene:t,camera:n,clearColor:this.clearColor})}},{key:"resetBuffers",value:function(){this.read=this.buffers[1],this.write=this.buffers[0]}},{key:"swapBuffers",value:function(){this.temp=this.read,this.read=this.write,this.write=this.temp}},{key:"render",value:function(e,t){this.resetBuffers(),this.renderToTexture(this.write,e,t);for(var n=this.passes.length,i=0;i<n;i++)this.passes[i].enable&&(this.swapBuffers(),this.passes[i].setUniform("u_input",this.read.texture),this.renderToTexture(this.write,this.passes[i].scene,this.camera));this.screen.setUniform("u_input",this.write.texture),this.renderer.render(this.screen.scene,this.camera)}}]),t}(),Ge=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};q(this,i),this.theme=e.theme||{font:"font-family:sans-serif;font-size:xx-small;font-weight:bold;line-height:15px;-moz-osx-font-smoothing: grayscale;-webkit-font-smoothing: antialiased;",color1:"#242424",color2:"#2a2a2a",color3:"#666",color4:"#999"};var t=document.createElement("div");t.style.cssText="position:fixed;bottom:0;left:0;min-width:80px;opacity:0.9;z-index:10000;",this.holder=document.createElement("div"),this.holder.style.cssText="padding:3px;background-color:"+this.theme.color1+";",t.appendChild(this.holder);var n=document.createElement("div");n.style.cssText=this.theme.font+";color:"+this.theme.color3+";",n.innerHTML="Performance",this.holder.appendChild(n),this.msTexts=[],this.domElement=t}return V(i,[{key:"rebuild",value:function(e){var n=this;this.msTexts=[],Object.keys(e).forEach(function(e){var t=document.createElement("div");t.style.cssText=n.theme.font+";color:"+n.theme.color4+";background-color:"+n.theme.color2+";",n.holder.appendChild(t),n.msTexts[e]=t})}},{key:"update",value:function(t){var n=this;Object.keys(this.msTexts).length!==Object.keys(t.performance).length&&this.rebuild(t.performance),Object.keys(t.performance).forEach(function(e){n.msTexts[e].textContent=e+": "+t.performance[e]})}}]),i}();e.chunks=n,e.utils=H,e.cameras=ne,e.shaders=ae,e.helpers=we,e.constants=t,e.Renderer=Ie,e.Object3=Z,e.Scene=Ae,e.Model=be,e.Mesh=_e,e.Texture=re,e.RenderTarget=Ce,e.Composer=je,e.Pass=Be,e.Performance=Ge,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e.lowww=e.lowww||{},e.lowww.core={}));
