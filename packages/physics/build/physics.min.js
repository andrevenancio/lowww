/*
lowww-physics - version: 1.1.5
Copyright Â© 2018 Andre Venancio (info@andrevenancio.com)
*/
var e,t;e=this,t=function(e){"use strict";var o="undefined"!=typeof Float32Array?Float32Array:Array;function i(){var e=new o(3);return e[0]=0,e[1]=0,e[2]=0,e}function s(e,t,i){var s=new o(3);return s[0]=e,s[1]=t,s[2]=i,s}function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function r(e,t,i,s){return e[0]=t[0]+i[0]*s,e[1]=t[1]+i[1]*s,e[2]=t[2]+i[2]*s,e}Math.PI;var t;function a(){var e=new o(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}i(),(t=new o(4))[0]=0,t[1]=0,t[2]=0,t[3]=0;var h;i(),s(1,0,0),s(0,1,0),a(),a(),(h=new o(9))[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,(c=new o(2))[0]=0,c[1]=0;var c,P="sphere-collider",u="rigid-body",l="force",C=i(),d=function(e,t){switch(e.collider.type){case P:t.collider.type===P?(c=t,x=(j=2*(h=e).collider.radius+2*c.collider.radius)*j,u=h.position,(A=(d=(l=c.position)[0]-u[0])*d+(f=l[1]-u[1])*f+(v=l[2]-u[2])*v)<x&&(B=C,F=h.position,O=c.position,B[0]=F[0]-O[0],B[1]=F[1]-O[1],B[2]=F[2]-O[2],o=(s=i=C)[0],n=s[1],r=s[2],0<(a=o*o+n*n+r*r)&&(a=1/Math.sqrt(a),i[0]=s[0]*a,i[1]=s[1]*a,i[2]=s[2]*a),y=c,b=x-A,g=C,w=(p=h).inversemass()+y.inversemass(),k=b*(p.inversemass()/w),m=b*(y.inversemass()/w),p.velocity[0]+=g[0]*k,p.velocity[1]+=g[1]*k,p.velocity[2]+=g[2]*k,y.velocity[0]-=g[0]*m,y.velocity[1]-=g[1]*m,y.velocity[2]-=g[2]*m)):t.collider.type}var i,s,o,n,r,a,h,c,u,l,d,f,v,p,y,b,g,w,k,m,B,F,O,j,x,A},f=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},v=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}(),p=0,y=0,b=0,g=0,w=0,k=0,m=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};f(this,t),y=e.timestep||1/180,b=e.time||Date.now()/1e3,this.force=i(),this.bodies=[],this.forces=[],this.paused=!0}return v(t,[{key:"add",value:function(e){e.type===u&&this.bodies.push(e),e.type===l&&this.forces.push(e)}},{key:"remove",value:function(e){if(e.type===u){var t=this.bodies.indexOf(e);-1!==t&&this.bodies.splice(t,1)}if(e.type===l){var i=this.forces.indexOf(e);-1!==i&&this.forces.splice(i,1)}}},{key:"pause",value:function(){!1===this.paused&&(this.paused=!0)}},{key:"resume",value:function(){!0===this.paused&&(this.paused=!1)}},{key:"update",value:function(){if(!this.paused){for(w=Date.now()/1e3,.25<(k=w-b)&&(k=.25),b=w,g+=k;y<=g;)this.step(),p+=y,g-=y;this.render()}}},{key:"step",value:function(){this.calculateWorldForces(),this.updateBounds(),this.collision(),this.integrate()}},{key:"calculateWorldForces",value:function(){this.force[0]=0,this.force[1]=0;for(var e=this.force[2]=0;e<this.forces.length;e++)this.force[0]+=this.forces[e].data[0],this.force[1]+=this.forces[e].data[1],this.force[2]+=this.forces[e].data[2];for(var t=0;t<this.bodies.length;t++)this.bodies[t].addForce(this.force)}},{key:"updateBounds",value:function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].updateBounds()}},{key:"collision",value:function(){for(var e=void 0,t=void 0,i=0;i<this.bodies.length-1;i++)for(var s=i+1;s<this.bodies.length;s++)e=this.bodies[i],t=this.bodies[s],d(e,t),0===i&&1===s&&console.log(e.collider)}},{key:"integrate",value:function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].integrate(y)}},{key:"render",value:function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].render(p)}},{key:"debug",value:function(){}}]),t}(),B=function(){function t(e){if(f(this,t),!e.collider)throw new Error("Please provide a collider");if(!e.mesh)throw new Error("Please provide a mesh");Object.assign(this,{type:u,awake:!0,lineardrag:.999,mass:1,velocity:i(),acceleration:i(),position:i(),force:i()},e),n(this.position,this.mesh.position.data)}return v(t,[{key:"inversemass",value:function(){return 1/this.mass}},{key:"addForce",value:function(e){n(this.force,e)}},{key:"integrate",value:function(e){this.awake&&(this.acceleration[0]=this.force[0]/this.mass,this.acceleration[1]=this.force[1]/this.mass,this.acceleration[2]=this.force[2]/this.mass,r(this.velocity,this.velocity,this.acceleration,e),r(this.position,this.position,this.velocity,e),this.velocity[0]*=this.lineardrag,this.velocity[1]*=this.lineardrag,this.velocity[2]*=this.lineardrag)}},{key:"updateBounds",value:function(){this.collider.updateBounds(this.position)}},{key:"render",value:function(){n(this.mesh.position.data,this.position)}}]),t}(),F=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};f(this,t),Object.assign(this,{type:P,radius:1},e)}return v(t,[{key:"updateBounds",value:function(e){this.left=e[0]-this.radius,this.right=e[0]+this.radius,this.top=e[1]+this.radius,this.bottom=e[1]-this.radius,this.front=e[2]+this.radius,this.back=e[2]-this.radius}}]),t}(),O=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};f(this,t),Object.assign(this,{type:"aabb-collider",width:1,height:1,depth:1},e)}return v(t,[{key:"updateBounds",value:function(e){var t=this.width/2,i=this.height/2,s=this.depth/2;this.left=e[0]-t,this.right=e[0]+t,this.top=e[1]+i,this.bottom=e[1]-i,this.front=e[2]+s,this.back=e[2]-s}}]),t}();e.World=m,e.RigidBody=B,e.SphereCollider=F,e.AABBCollider=O,e.Force=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:i();f(this,e),this.type=l,this.data=s(t[0],t[1],t[2])},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e.lowww=e.lowww||{},e.lowww.physics={}));
